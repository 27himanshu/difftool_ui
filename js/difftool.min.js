define(["vs/editor/editor.main","dt/editorUtils.min"],(t,e)=>{const o={setupMonacoTab:function(e){if(this._setup)return;let o=localStorage.getItem("dtOriginalText");null==o&&(o="just some text\n\nHello World\n\nSome more text");let i=localStorage.getItem("dtModifiedText");null==i&&(i="just some Text\n\nHello World\n\nSome more changes");const d=t.editor.createModel(o,"text/plain"),n=t.editor.createModel(i,"text/plain");this.diffEditor=t.editor.createDiffEditor(e,{originalEditable:!0,readOnly:!1,theme:"vs-dark"}),this.diffEditor.setModel({original:d,modified:n}),this.setupTabBar(),this.setupSessionPersistence(),this._setup=!0},setupSessionPersistence:function(){window.addEventListener("visibilitychange",t=>{const o=this.diffEditor.getModel().original.getValue();localStorage.setItem("dtOriginalText",o);const i=this.diffEditor.getModel().modified.getValue();localStorage.setItem("dtModifiedText",i);const d=document.getElementById("dt-difftool-language-type-selector");localStorage.setItem("dtLanguageType",d.value),localStorage.setItem("dtSideBySide",e.getSideBySideValue(".dt-difftool-sidebyside-button span")),localStorage.setItem("dtWordWrap",e.getWordWrapValue(".dt-difftool-wordwrap-button span"))})},setupTabBar:function(){const t=document.getElementById("dt-difftool-language-type-selector");let o=localStorage.getItem("dtLanguageType");null==o&&(o=e.DEFAULT_LANGUAGE),t.value=o,this.updateLanguage(o),t.addEventListener("change",t=>{this.updateLanguage(t.target.value)});const i=document.querySelector("button.dt-difftool-autoformat-button");i.addEventListener("click",t=>{this.autoformat()});const d="true"===localStorage.getItem("dtWordWrap");this.updateWordWrap(d);const n=document.querySelector("button.dt-difftool-wordwrap-button");n.addEventListener("click",t=>{this.toggleWordWrap()});let a=localStorage.getItem("dtSideBySide");a=null==a?!(navigator.userAgent.indexOf("Mobi")>-1):"false"!==a,this.updateSideBySide(a);const r=document.querySelector(".dt-difftool-sidebyside-button");r.addEventListener("click",t=>{this.toggleSideBySide()});const l=document.querySelector("button.dt-difftool-download-button");l.addEventListener("click",t=>{this.downloadFiles()})},downloadFiles:function(){const t=this.diffEditor.getModel().original.getValue(),e=this.diffEditor.getModel().modified.getValue(),o=new Blob([t],{type:"text/plain"}),i=document.createElement("a");let d=(new Date).toLocaleString([],{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0});d=d.replace(/, /,"-"),d=d.replace(/ /,"_");const n=`Difftool_Original_${d}.txt`;i.href=URL.createObjectURL(o),i.download=n,i.click(),URL.revokeObjectURL(i.href);const a=new Blob([e],{type:"text/plain"}),r=document.createElement("a"),l=`Difftool_Modified_${d}.txt`;r.href=URL.createObjectURL(a),r.download=l,r.click(),URL.revokeObjectURL(r.href)},toggleSideBySide:function(){const t=e.getSideBySideValue(".dt-difftool-sidebyside-button span");this.updateSideBySide(!t)},toggleWordWrap:function(){const t=e.getWordWrapValue(".dt-difftool-wordwrap-button span");this.updateWordWrap(!t)},updateSideBySide:function(t){const o=document.querySelector(".dt-difftool-sidebyside-button span");o.textContent=e.getSideBySideLabel(t),this.diffEditor.updateOptions({renderSideBySide:t})},updateWordWrap:function(t){const o=document.querySelector(".dt-difftool-wordwrap-button span");o.textContent=e.getWordWrapLabel(t),this.diffEditor.updateOptions({wordWrap:t?"on":"off"})},updateLanguage:async function(o){await t.editor.setModelLanguage(this.diffEditor.getModel().modified,o),await t.editor.setModelLanguage(this.diffEditor.getModel().original,o),e.AUTOFORMAT_SUPPORTED_LANGUAGE.indexOf(o)<0?this.hideTabBarButton(".dt-difftool-autoformat-button"):this.showTabBarButton(".dt-difftool-autoformat-button")},hideTabBarButton:function(t){const e=document.querySelector(t);e.parentNode.classList.add("dt-hidden")},showTabBarButton:function(t){const e=document.querySelector(t);e.parentNode.classList.remove("dt-hidden")},autoformat:function(){this.diffEditor.getOriginalEditor().getAction("editor.action.formatDocument").run(),this.diffEditor.getModifiedEditor().getAction("editor.action.formatDocument").run()},resize:function(){this._setup&&this.diffEditor.layout()},updateTheme:function(t){this._setup&&this.diffEditor.updateOptions({theme:`vs-${t}`})}};return o});