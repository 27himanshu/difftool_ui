define(["vs/editor/editor.main","dt/editorUtils.min"],(t,e)=>{const o=["javascript","json","html","typescript"],n="txt",r={setupMonacoTab:function(e){if(this._setup)return;let o=localStorage.getItem("eText");null==o&&(o="just some text\n\nHello World\n\nSome more text");const n=t.editor.createModel(o,"text/plain");this.editor=t.editor.create(e,{theme:"vs-dark",minimap:{enabled:!1}}),this.editor.setModel(n);const r=(t,e)=>{let o=null;return(...n)=>{window.clearTimeout(o),o=window.setTimeout(()=>{t(...n)},e)}},a=r(()=>{this.editor.layout()},100);this.setupTabBar(),window.addEventListener("resize",a),this.setupSessionPersistence(),this._setup=!0},setupSessionPersistence:function(){window.addEventListener("visibilitychange",t=>{const o=this.editor.getModel().getValue();localStorage.setItem("eText",o);const n=document.getElementById("dt-editor-language-type-selector");localStorage.setItem("eLanguageType",n.value),localStorage.setItem("eWordWrap",e.getWordWrapValue(".dt-editor-wordwrap-button span"))})},setupTabBar:function(){const t=document.getElementById("dt-editor-language-type-selector");let e=localStorage.getItem("eLanguageType");null==e&&(e=n),t.value=e,this.updateLanguage(e),t.addEventListener("change",t=>{this.updateLanguage(t.target.value)});const o=document.querySelector("button.dt-editor-autoformat-button");o.addEventListener("click",t=>{this.autoformat()});const r=document.querySelector("button.dt-editor-download-button");r.addEventListener("click",t=>{this.downloadFile()});const a="true"===localStorage.getItem("eWordWrap");this.updateWordWrap(a);const i=document.querySelector("button.dt-editor-wordwrap-button");i.addEventListener("click",t=>{this.toggleWordWrap()})},downloadFile:function(){const t=this.editor.getModel().getValue(),e=new Blob([t],{type:"text/plain"}),o=document.createElement("a");let n=(new Date).toLocaleString([],{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0});n=n.replace(/, /,"-"),n=n.replace(/ /,"_");const r=`Difftool_Editor_${n}.txt`;o.href=URL.createObjectURL(e),o.download=r,o.click(),URL.revokeObjectURL(o.href)},toggleWordWrap:function(){const t=e.getWordWrapValue(".dt-editor-wordwrap-button span");this.updateWordWrap(!t)},updateWordWrap:function(t){const o=document.querySelector(".dt-editor-wordwrap-button span");o.textContent=e.getWordWrapLabel(t),this.editor.updateOptions({wordWrap:t?"on":"off"})},updateLanguage:async function(e){await t.editor.setModelLanguage(this.editor.getModel(),e),o.indexOf(e)<0?this.hideTabBarButton(".dt-editor-autoformat-button"):this.showTabBarButton(".dt-editor-autoformat-button")},hideTabBarButton:function(t){const e=document.querySelector(t);e.parentNode.classList.add("dt-hidden")},showTabBarButton:function(t){const e=document.querySelector(t);e.parentNode.classList.remove("dt-hidden")},autoformat:function(){this.editor.getAction("editor.action.formatDocument").run()},resize:function(){this._setup&&this.editor.layout()},updateTheme:function(t){this._setup&&this.editor.updateOptions({theme:`vs-${t}`})}};return r});